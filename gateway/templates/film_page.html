<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ nombre }} - P치gina de la Pel칤cula</title>
    <link rel="stylesheet" href="/static/film_page_css.css">
</head>
<body>
    <main class="container">
        <h1>游꿟 CineView</h1>
        <h2>{{ nombre }} ({{ anio }})</h2>
        <div class="flex-container">
            <!-- Secci칩n de car치tula -->
            <section class="caratula right-container">
                <img src="{{ foto_car_tula }}" alt="Car치tula de {{ nombre }}">
            </section>
    
            <!-- Secci칩n de informaci칩n -->
            <section class="info left-container">
                <h2>Sinopsis</h2>
                <p>{{ sinopsis }}</p>    

                <h2>Actores</h2>
                <ul>
                    {% for actor in actores %}
                    <li>
                        <a href="/actor_page/{{ actor[1] }}" class="movie-link">
                            <img src="{{ actor[2] }}" alt="Foto de {{ actor[0] }}">
                            <span>{{ actor[0] }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
    
                <h2>Directores</h2>
                <ul>
                    {% for director in directores %}
                    <li>
                        <a href="/director_page/{{ director[1] }}" class="movie-link">
                            <img src="{{ director[2] }}" alt="Foto de {{ director[0] }}">
                            <span>{{ director[0] }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </section>
        </div>

        <!-- Secci칩n de rese침as -->
        <section class="reviews">
            <h2>Rese침as</h2>
            {% if reviews %}
            <ul>
                {% for review in reviews %}
                <li>
                    <blockquote>{{ review.content }}</blockquote>
                    <cite>- {{ review.username }}</cite>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p>No hay rese침as disponibles para esta pel칤cula.</p>
            {% endif %}
            <hr>
            <!-- Formulario para a침adir una rese침a -->
            <form id="reviewForm">
                <h3>A침ade tu rese침a</h3>
                <textarea id="reviewContent" name="content" rows="4" cols="50" placeholder="Escribe tu rese침a aqu칤..."></textarea>
                <br>
                <button type="submit">Enviar rese침a</button>
            </form>
        </section>
        
        <!-- Script para manejar el formulario -->
        <script>
            document.getElementById('reviewForm').addEventListener('submit', async (event) => {
                event.preventDefault();
                
                const content = document.getElementById('reviewContent').value.trim();
                if (!content) {
                    alert('Por favor, escribe algo en la rese침a.');
                    return;
                }

                try {
                    const response = await fetch('/add_review', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('jwt')}`
                        },
                        body: JSON.stringify({
                            user_id: 0, // Sustituir por el ID real del usuario si est치 disponible
                            movie_id: {{ movie_id | tojson }}, // Variable pasada desde la plantilla
                            content: content
                        })
                    });
                    
                    if (response.ok) {
                        alert('춰Rese침a agregada exitosamente!');
                        location.reload();
                    } else {
                        const error = await response.json();
                        alert(`Error al agregar la rese침a: ${error.msg}`);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Hubo un problema al agregar la rese침a.');
                }
            });
        </script>        
    </main>
</body>
</html>
